# GameWorld - æ¨¡å‹ç”Ÿæˆæœ€å°éªŒè¯Demo

åŸºäº **ERPE æ¡†æ¶**ï¼ˆEntity/Resource/Process/Effectï¼‰çš„ç¨‹åºåŒ–è§’è‰²ç”Ÿæˆç³»ç»ŸéªŒè¯é¡¹ç›®ã€‚

æœ¬é¡¹ç›®å®ç°äº†ä»**é€»è¾‘åŸºå› **åˆ°**å¤–è§‚åŸºå› **å†åˆ°**å‡ ä½•æ¨¡å‹**çš„å®Œæ•´æ•°æ®æµï¼Œå¹¶ä¸ºæœªæ¥çš„ç”Ÿæ€ç³»ç»Ÿã€ç§ç¾¤ç®¡ç†ç­‰åŠŸèƒ½é¢„ç•™äº†æ¸…æ™°çš„æ¶æ„æ‰©å±•ç‚¹ã€‚

---

## ğŸ“‹ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### ERPE = ECS çš„å…·ä½“åº”ç”¨

æœ¬é¡¹ç›®ä¸­ï¼Œ**ERPE æœ¬è´¨ä¸Šå°±æ˜¯ ECSï¼ˆEntity-Component-Systemï¼‰çš„å…·ä½“åº”ç”¨æ¡†æ¶**ï¼š

| ERPEæ¦‚å¿µ | ECSå¯¹åº” | è¯´æ˜ |
|---------|---------|------|
| **Entity** | Entity | å¸¦IDçš„çŠ¶æ€å®¹å™¨ï¼ˆä¸ªä½“ã€ç§ç¾¤ã€åŠ¿åŠ›ç­‰ï¼‰ |
| **Resource** | Componentæ•°æ® | å¯è®¡é‡çš„æ•°å€¼/çŠ¶æ€ï¼ˆHPã€åŸºå› ã€ææ–™ç­‰ï¼‰ |
| **Process** | System | é€»è¾‘å¤„ç†å•å…ƒï¼ˆåŸå­åŒ–æ“ä½œçš„ç»„åˆï¼‰ |
| **Effect** | çŠ¶æ€å˜æ›´æ—¥å¿— | ä¸–ç•ŒçŠ¶æ€çš„diffè®°å½• |

å› æ­¤ï¼Œ**ERPEä¸ECSæ˜¯èåˆä¸€ä½“çš„**ï¼Œä¸æ˜¯ä¸¤å¥—ç‹¬ç«‹ç³»ç»Ÿã€‚

### æ¨¡å‹ç”Ÿæˆä¸ERPEçš„å…³ç³»

æ ¹æ®è®¾è®¡æ–‡æ¡£ `docs/æ¨¡å‹ç”Ÿæˆ.md`ï¼š

> "ERPE è´Ÿè´£ï¼šç‰©ç§ã€ä¸ªä½“ã€ç§ç¾¤ã€åŠ¿åŠ›ã€è¡Œä¸ºã€æ•°å€¼"  
> "å‡ ä½•å­ç³»ç»Ÿè´Ÿè´£ï¼šMesh / Skeleton / Avatar èµ„æº"  
> "é€šè¿‡æ¡¥æ¥å±‚ç”¨åŸºå› æŠŠä¸¤è€…ä¸²èµ·æ¥"

**å‡ ä½•ç”Ÿæˆæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„å­ç³»ç»Ÿ**ï¼š
- **è¾“å…¥**ï¼š`AppearanceGene`ï¼ˆæ¥è‡ªERPEç»„ä»¶ï¼‰
- **è¾“å‡º**ï¼š`MeshData`ï¼ˆçº¯å‡ ä½•æ•°æ®ï¼Œå¼•æ“æ— å…³ï¼‰
- **ä¸ç›´æ¥ä¾èµ–**ï¼šERPEçš„Processç³»ç»Ÿ

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
GameWorld/
â”œâ”€â”€ docs/                          # è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ ERPE.md                    # ERPEæ¡†æ¶æ€»è®¾è®¡
â”‚   â”œâ”€â”€ æ¨¡å‹ç”Ÿæˆ.md                 # åŸºå› åˆ°å‡ ä½•çš„ç”Ÿæˆæµç¨‹
â”‚   â””â”€â”€ ç§ç¾¤.md                     # ç§ç¾¤ä¸åŠ¿åŠ›ç³»ç»Ÿè®¾è®¡
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                      # ECSåŸºç¡€è®¾æ–½ï¼ˆERPEåº•å±‚ï¼‰
â”‚   â”‚   â””â”€â”€ Types.h                # åŸºç¡€ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ gene/                      # åŸºå› æ•°æ®å®šä¹‰ï¼ˆå±äºResourceï¼‰
â”‚   â”‚   â”œâ”€â”€ GameplayGene.h         # é€»è¾‘åŸºå› ï¼šå‚ä¸æ•°å€¼ã€AI
â”‚   â”‚   â””â”€â”€ AppearanceGene.h       # å¤–è§‚åŸºå› ï¼šåªç”¨äºè§†è§‰
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                # ERPEç»„ä»¶ï¼ˆECSçš„Componentï¼‰
â”‚   â”‚   â””â”€â”€ Components.h           # GameplayGene, Appearance, Stats, Population
â”‚   â”‚
â”‚   â”œâ”€â”€ systems/                   # ERPEçš„Processï¼ˆECSçš„Systemï¼‰
â”‚   â”‚   â”œâ”€â”€ GeneSystem.h           # åŸºå› æ˜ å°„Processï¼ˆå£°æ˜ï¼‰
â”‚   â”‚   â””â”€â”€ GeneSystem.cpp         # åŸºå› æ˜ å°„Processï¼ˆå®ç°ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ geometry/                  # ç‹¬ç«‹çš„å‡ ä½•ç”Ÿæˆå­ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ MeshData.h             # çº¯æ•°æ®ç»“æ„ï¼ˆå¼•æ“æ— å…³ï¼‰
â”‚   â”‚   â”œâ”€â”€ IAvatarGenerator.h     # ç”Ÿæˆå™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ SimpleAvatarGenerator.h   # ç®€å•å®ç°ï¼ˆå£°æ˜ï¼‰
â”‚   â”‚   â””â”€â”€ SimpleAvatarGenerator.cpp # ç®€å•å®ç°ï¼ˆå®ç°ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ render/                    # æ¸²æŸ“é€‚é…å±‚
â”‚   â”‚   â”œâ”€â”€ IRenderAdapter.h       # é€‚é…å™¨æ¥å£
â”‚   â”‚   â””â”€â”€ ConsoleAdapter.h       # æ§åˆ¶å°è¾“å‡ºå®ç°
â”‚   â”‚
â”‚   â””â”€â”€ tools/                     # å·¥å…·ç±»ï¼ˆå¯¼å‡ºã€åºåˆ—åŒ–ç­‰ï¼‰
â”‚       â”œâ”€â”€ ObjExporter.h          # OBJæ ¼å¼å¯¼å‡ºå™¨ï¼ˆå£°æ˜ï¼‰
â”‚       â””â”€â”€ ObjExporter.cpp        # OBJæ ¼å¼å¯¼å‡ºå™¨ï¼ˆå®ç°ï¼‰
â”‚
â”œâ”€â”€ output/                        # ç”Ÿæˆçš„OBJæ–‡ä»¶è¾“å‡ºç›®å½•
â”‚
â”œâ”€â”€ main.cpp                       # Demoå…¥å£
â”œâ”€â”€ CMakeLists.txt                 # æ„å»ºé…ç½®
â””â”€â”€ README.md                      # æœ¬æ–‡ä»¶
```

### æ¶æ„è¯´æ˜

**å¤´æ–‡ä»¶/å®ç°æ–‡ä»¶åˆ†ç¦»**ï¼š
- æ‰€æœ‰éæ¨¡æ¿ç±»éƒ½éµå¾ª `.h` (å£°æ˜) + `.cpp` (å®ç°) çš„æ ‡å‡†C++å®è·µ
- å¤´æ–‡ä»¶åªåŒ…å«æ¥å£å®šä¹‰ï¼Œå®ç°ç»†èŠ‚éšè—åœ¨ `.cpp` æ–‡ä»¶ä¸­
- å‡å°‘ç¼–è¯‘ä¾èµ–ï¼Œæå‡æ„å»ºé€Ÿåº¦

**tools ç›®å½•**ï¼š
- åŒ…å«è¾…åŠ©å·¥å…·ç±»ï¼ˆå¯¼å‡ºå™¨ã€åºåˆ—åŒ–å™¨ã€æ—¥å¿—ç­‰ï¼‰
- ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘è§£è€¦ï¼Œä¾¿äºå¤ç”¨å’Œæµ‹è¯•

---

## ğŸ§¬ æ ¸å¿ƒæ•°æ®æµ

### å®Œæ•´æ•°æ®æµå‘ï¼ˆå•å‘ï¼‰

```
GameplayGene (é€»è¾‘æƒå¨)
    â†“
    â”œâ”€â”€â†’ Stats (æ•°å€¼è®¡ç®—)           [æœªæ¥å®ç°]
    â”‚
    â””â”€â”€â†’ AppearanceGene (è§†è§‰æ˜ å°„)
            â†“
         AvatarBundle (å‡ ä½•ç”Ÿæˆ)
            â†“
         AvatarId (æ¸²æŸ“é€‚é…ä¸Šä¼ )
```

**å…³é”®åŸåˆ™**ï¼š
- **é€»è¾‘åŸºå› æ˜¯å”¯ä¸€æƒå¨**ï¼šæ‰€æœ‰å‚ä¸æ”»å‡»åŠ›ã€é€Ÿåº¦çš„å‚æ•°éƒ½åœ¨ `GameplayGene`
- **å¤–è§‚ä¸å›å†™é€»è¾‘**ï¼š`AppearanceGene` å˜åŒ–ä¸ä¼šå½±å“ `GameplayGene`
- **å‡ ä½•ç³»ç»Ÿä¸ä¿®æ”¹ERPEçŠ¶æ€**ï¼šçº¯æ•°æ®ç”Ÿæˆï¼Œä¸å‚ä¸æ¸¸æˆé€»è¾‘

### å…±äº«å­—æ®µï¼ˆShared Fieldsï¼‰

éƒ¨åˆ†åŸºå› å­—æ®µåŒæ—¶å½±å“é€»è¾‘å’Œå¤–è§‚ï¼š

| å­—æ®µ | é€»è¾‘ç”¨é€” | å¤–è§‚ç”¨é€” |
|-----|---------|---------|
| `limb_length` | æ”»å‡»è·ç¦»ã€æ­¥å¹… | æ¨¡å‹èº«é«˜ã€æ‰‹è„šæ¯”ä¾‹ |
| `body_mass` | æƒ¯æ€§ã€æ’å‡»åŠ› | èƒ–ç˜¦æ„Ÿ |
| `size_scale` | ç¢°æ’ä½“ç§¯ | æ¨¡å‹æ•´ä½“ç¼©æ”¾ |

---

## ğŸ¨ å‘½åçº¦å®š

### ä¸ºä»€ä¹ˆä¸ç”¨ `C_` å‰ç¼€ï¼Ÿ

è®¾è®¡æ–‡æ¡£ä¸­ä½¿ç”¨ `C_GameplayGene`ã€`C_Appearance` ç­‰å‘½åæ¥è‡ªä¼ ç»ŸECSå®è·µã€‚

**åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨æ›´ç°ä»£çš„æ–¹å¼**ï¼š

```cpp
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼ˆæ–‡æ¡£ä¸­çš„æ¦‚å¿µå‘½åï¼‰
struct C_GameplayGene { ... };
struct C_Appearance { ... };

// âœ… æœ¬é¡¹ç›®å®ç°ï¼ˆä½¿ç”¨namespaceï¼‰
namespace component {
    struct GameplayGene { ... };
    struct Appearance { ... };
}

// ä½¿ç”¨æ—¶
component::GameplayGene gene_comp;
component::Appearance   appear_comp;
```

**ä¼˜åŠ¿**ï¼š
- ä»£ç ç®€æ´è‡ªç„¶
- èŒè´£æ¸…æ™°ï¼ˆ`component::` å‘½åç©ºé—´ä¸“é—¨æ”¾ç»„ä»¶ï¼‰
- ç¬¦åˆç°ä»£C++é£æ ¼

---

## ğŸš€ å½“å‰å®ç°çŠ¶æ€

### âœ… å·²å®Œæˆ

- [x] æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆ`GameplayGene`, `AppearanceGene`, `MeshData`ï¼‰
- [x] ç»„ä»¶å®šä¹‰ï¼ˆä½¿ç”¨ `namespace component`ï¼‰
- [x] åŸºå› æ˜ å°„ç³»ç»Ÿï¼ˆ`systems::BuildAppearanceFromGameplay`ï¼‰
- [x] ç®€å•å‡ ä½•ç”Ÿæˆå™¨ï¼ˆ`SimpleAvatarGenerator` - äººå½¢ç«‹æ–¹ä½“æ¨¡å‹ï¼‰
- [x] æ¸²æŸ“é€‚é…å±‚ï¼ˆ`ConsoleAdapter` - æ§åˆ¶å°è°ƒè¯•è¾“å‡ºï¼‰
- [x] OBJå¯¼å‡ºå™¨ï¼ˆæ”¯æŒæè´¨é¢œè‰²çš„ `.obj`/`.mtl` æ–‡ä»¶å¯¼å‡ºï¼‰
- [x] DemoéªŒè¯åœºæ™¯ï¼ˆä¸‰ä¸ªä¸åŒåŸºå› ä¸ªä½“çš„å®Œæ•´ç”Ÿæˆæµç¨‹ï¼‰
- [x] CMakeé…ç½®ï¼ˆè§„èŒƒçš„includeè·¯å¾„ï¼Œ`.h`/`.cpp` åˆ†ç¦»ï¼‰

### ğŸ¯ éªŒè¯ç»“æœ

**æ•°æ®æµå®Œæ•´æ€§**ï¼š
```
GameplayGene â†’ AppearanceGene â†’ MeshData â†’ OBJæ–‡ä»¶
```

**ä¸‰ä¸ªæµ‹è¯•ä¸ªä½“**ï¼š
1. **Agile Scout** (æ•æ·ä¾¦å¯Ÿå…µ)ï¼šç»†é•¿èº«æ (fatness=1.0)
2. **Heavy Warrior** (é‡å‹æˆ˜å£«)ï¼šé­æ¢§ä½“å‹ (fatness=2.33, musculature=2.0)
3. **Balanced Mage** (å‡è¡¡æ³•å¸ˆ)ï¼šä¸­ç­‰èº«æ (fatness=1.33)

å¯ä½¿ç”¨ **Windows 3D Viewer** æˆ– **Blender** æ‰“å¼€ `output/` ç›®å½•ä¸‹çš„ `.obj` æ–‡ä»¶æŸ¥çœ‹æ¨¡å‹ã€‚

### ğŸ“¦ é¢„ç•™æ‰©å±•ç‚¹

- [ ] **Processç³»ç»Ÿ**ï¼šåŸå­åŒ–æ“ä½œï¼ˆCheck, Compute, Consume, Spawnç­‰ï¼‰
- [ ] **Statsè®¡ç®—**ï¼šä» `GameplayGene` æ¨å¯¼æ¸¸æˆæ•°å€¼
- [ ] **ç§ç¾¤ç³»ç»Ÿ**ï¼šHQ/LQåŒºåˆ‡æ¢ã€ç§ç¾¤ç»Ÿè®¡
- [ ] **åŠ¿åŠ›ç³»ç»Ÿ**ï¼šFactionç»„ä»¶ã€æ”¿æ²»/ç»æµæ¶Œç°
- [ ] **å®Œæ•´ECS**ï¼šEntityç®¡ç†ã€Systemè°ƒåº¦

---

## ğŸ”§ å¦‚ä½•æ‰©å±•

### æ·»åŠ æ–°çš„Processï¼ˆSystemï¼‰

1. åœ¨ `src/systems/` åˆ›å»ºæ–°çš„Systemç±»
2. å®šä¹‰åŸå­åŒ–æ“ä½œï¼ˆå‚è€ƒ `docs/ERPE.md` çš„åŸå­Processåˆ—è¡¨ï¼‰
3. é€šè¿‡è¯»å†™Componentæ¥æ“ä½œEntity

ç¤ºä¾‹ç»“æ„ï¼š
```cpp
// src/systems/StatsSystem.h
class StatsSystem {
public:
    // æ ¹æ®GameplayGeneé‡æ–°è®¡ç®—Stats
    void RecalcStats(EntityId entity) {
        auto& gene = GetComponent<component::GameplayGene>(entity);
        auto& stats = GetComponent<component::Stats>(entity);
        
        stats.attack_power = ComputeAttack(gene.gene.base_strength);
        stats.move_speed   = ComputeSpeed(gene.gene.base_agility);
        // ...
    }
};
```

### æ·»åŠ æ–°çš„Component

åœ¨ `src/components/Components.h` çš„ `namespace component` ä¸­æ·»åŠ ï¼š

```cpp
namespace component {
    struct YourNewComponent {
        // æ•°æ®å­—æ®µ
    };
}
```

### é›†æˆåˆ°å®Œæ•´çš„ECS

æœªæ¥å¯ä»¥é›†æˆç¬¬ä¸‰æ–¹ECSåº“ï¼ˆå¦‚EnTTï¼‰ï¼Œæˆ–å®ç°ç®€å•çš„Entityç®¡ç†å™¨ï¼š

```cpp
class World {
    std::unordered_map<EntityId, std::any> components;
    // ç»„ä»¶å­˜å‚¨ã€Systemè°ƒåº¦ç­‰
};
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- `docs/ERPE.md` - ERPEæ¡†æ¶æ€»è®¾è®¡ï¼ˆEntity/Resource/Process/Effectï¼‰
- `docs/æ¨¡å‹ç”Ÿæˆ.md` - åŸºå› åˆ†å±‚ä¸å‡ ä½•ç”Ÿæˆæµç¨‹
- `docs/ç§ç¾¤.md` - ç§ç¾¤ã€ä¸ªä½“ã€åŠ¿åŠ›çš„ç»Ÿä¸€è®¾è®¡

---

## ğŸ¯ æœ€å°éªŒè¯ç›®æ ‡

æœ¬Demoæ—¨åœ¨éªŒè¯ï¼š

1. âœ… **åŸºå› åˆ†å±‚å¯è¡Œæ€§**ï¼š`GameplayGene` â†’ `AppearanceGene` æ˜ å°„
2. âœ… **ç¨‹åºåŒ–ç”Ÿæˆæµç¨‹**ï¼šåŸºå› å‚æ•° â†’ å‡ ä½•è¾“å‡º â†’ å¯è§†åŒ–éªŒè¯
3. âœ… **æ¶æ„å¯æ‰©å±•æ€§**ï¼šæˆåŠŸéªŒè¯äº† ERPE/ECS æ¶æ„ï¼Œä¸ºæœªæ¥æ‰©å±•å¥ å®šåŸºç¡€

**è®¾è®¡åŸåˆ™**ï¼šæœ€å°å®ç° + æœ€å¤§æ‰©å±•æ€§ï¼Œé¿å…æœªæ¥å¤§å¹…é‡æ„ã€‚

---

## ğŸ”¨ ç¼–è¯‘ä¸è¿è¡Œ

### æ„å»ºé¡¹ç›®

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cmake -B build -G "Visual Studio 17 2022"
cmake --build build --config Release
```

> **ğŸ’¡ è‡ªåŠ¨æºæ–‡ä»¶å‘ç°**ï¼šé¡¹ç›®ä½¿ç”¨ `GLOB + CONFIGURE_DEPENDS`ï¼Œæ·»åŠ æ–° `.cpp` æ–‡ä»¶åï¼š
> - âœ… **æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ CMakeLists.txt**
> - âœ… **ç›´æ¥è¿è¡Œ `cmake --build build` å³å¯**ï¼ˆè‡ªåŠ¨æ£€æµ‹æ–‡ä»¶å˜åŒ–ï¼‰
> - ğŸ“ æ”¯æŒçš„ç›®å½•ï¼š`src/systems/`, `src/geometry/`, `src/tools/`, `src/render/`

### è¿è¡ŒDemo

```bash
build\Release\GameWorld.exe
```

ç”Ÿæˆçš„ `.obj` æ–‡ä»¶ä½äº `output/` ç›®å½•ï¼Œå¯ä½¿ç”¨ï¼š
- **Windows 3D Viewer**ï¼ˆWin10/11è‡ªå¸¦ï¼‰
- **Blender**ï¼ˆå¼€æº3Dè½¯ä»¶ï¼‰
- ä»»ä½•æ”¯æŒOBJæ ¼å¼çš„3DæŸ¥çœ‹å™¨

---

## ğŸŒŸ ä¸‹ä¸€æ­¥è®¡åˆ’

### è¿‘æœŸæ‰©å±•
- [ ] æ·»åŠ æ›´å¤šä½“å‹å˜åŒ–ï¼ˆè‚Œè‚‰ã€éª¨éª¼ç»†èŠ‚ï¼‰
- [ ] å®ç°éª¨éª¼ç³»ç»Ÿï¼ˆ`Skeleton`ï¼‰
- [ ] æ·»åŠ ç§ç¾¤ç»„ä»¶ï¼ˆ`component::Population`ï¼‰

### ä¸­æœŸç›®æ ‡
- [ ] Statsç³»ç»Ÿï¼ˆä»åŸºå› æ¨å¯¼æ•°å€¼ï¼‰
- [ ] ProcessåŸå­åŒ–æ“ä½œï¼ˆCheck/Compute/Consumeç­‰ï¼‰
- [ ] å®Œæ•´çš„ECS Entityç®¡ç†å™¨

### é•¿æœŸæ„¿æ™¯
- [ ] ç§ç¾¤æ¼”åŒ–ç³»ç»Ÿ
- [ ] åŠ¿åŠ›/æ”¿æ²»ç³»ç»Ÿ
- [ ] AIè¡Œä¸ºæ ‘é›†æˆ
